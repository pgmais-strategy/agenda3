<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Abrir Calend√°rio</title>

  <!-- Evita cache -->
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="font-family: Arial, sans-serif; text-align:center; padding:40px;">

  <h2>üìÖ Abrindo o calend√°rio‚Ä¶</h2>
  <p>Se n√£o abrir automaticamente, toque no bot√£o abaixo:</p>

  <a id="btnCalendar"
     style="
       display:inline-block;
       margin-top:20px;
       padding:14px 22px;
       background:#1a73e8;
       color:#fff;
       text-decoration:none;
       border-radius:8px;
       font-size:16px;
     ">
     Abrir no Google Calendar
  </a>

  <script>
    // Pega a data de hoje em America/Sao_Paulo e soma N dias
    function getDataSaoPauloMais(dias) {
      const agora = new Date();

      const spString = agora.toLocaleString('en-CA', {
        timeZone: 'America/Sao_Paulo',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour12: false
      });

      const [dataParte] = spString.split(',');
      const [ano, mes, dia] = dataParte.split('-').map(Number);

      const spDate = new Date(ano, mes - 1, dia + dias);

      const y = spDate.getFullYear();
      const m = String(spDate.getMonth() + 1).padStart(2, '0');
      const d = String(spDate.getDate()).padStart(2, '0');

      return `${y}${m}${d}`;
    }

    // Hoje + 2 dias
    const data = getDataSaoPauloMais(2);

    // 08:00‚Äì09:00 BRT = 11:00‚Äì12:00 UTC
    const inicioUTC = `${data}T110000Z`;
    const fimUTC = `${data}T120000Z`;

    // Deep link correto do Google Calendar (abre o app quando poss√≠vel)
    const googleCalendarURL =
      `https://www.google.com/calendar/render` +
      `?action=TEMPLATE` +
      `&text=Agendamento` +
      `&dates=${inicioUTC}/${fimUTC}` +
      `&details=Agendamento+autom√°tico`;

    // Gera arquivo .ics (iOS / Apple Calendar)
    function gerarICS() {
      const conteudoICS = `
BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:Agendamento
DTSTART:${inicioUTC}
DTEND:${fimUTC}
DESCRIPTION:Agendamento autom√°tico
END:VEVENT
END:VCALENDAR
`.trim();

      const blob = new Blob([conteudoICS], {
        type: 'text/calendar;charset=utf-8'
      });

      return URL.createObjectURL(blob);
    }

    const ua = navigator.userAgent;
    const isIOS = /iPhone|iPad|iPod/i.test(ua);

    // Define bot√£o
    document.getElementById('btnCalendar').href = googleCalendarURL;

    // Tenta abrir automaticamente
    setTimeout(() => {
      if (isIOS) {
        window.location.href = gerarICS();
      } else {
        window.location.href = googleCalendarURL;
      }
    }, 300);
  </script>

</body>
</html>
