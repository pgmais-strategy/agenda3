<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Abrir Calendário</title>

  <!-- Evita cache -->
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

  <script>
    // Pega a data de hoje em America/Sao_Paulo e soma N dias
    function getDataSaoPauloMais(dias) {
      const agora = new Date();

      const spString = agora.toLocaleString('en-CA', {
        timeZone: 'America/Sao_Paulo',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour12: false
      });

      const [dataParte] = spString.split(',');
      const [ano, mes, dia] = dataParte.split('-').map(Number);

      const spDate = new Date(ano, mes - 1, dia + dias);

      const y = spDate.getFullYear();
      const m = String(spDate.getMonth() + 1).padStart(2, '0');
      const d = String(spDate.getDate()).padStart(2, '0');

      return `${y}${m}${d}`;
    }

    // Hoje + 5 dias
    const data = getDataSaoPauloMais(5);

    // 08:00–09:00 BRT = 11:00–12:00 UTC
    const inicioUTC = `${data}T110000Z`;
    
    const fimUTC = `${data}T120000Z`;
    
    // Data para exibição (dd/mm/aaaa)
    const dataTexto = `${data.slice(6,8)}/${data.slice(4,6)}/${data.slice(0,4)}`;
    
    // Deep link correto do Google Calendar (abre o app quando possível)
    const googleCalendarURL =
      `https://www.google.com/calendar/render` +
      `?action=TEMPLATE` +
      `&text=Bradesco | Lembrete de Parcela` +
      `&dates=${inicioUTC}/${fimUTC}` +
      `&details=Seu acordo com o Bradesco vence em ${dataTexto}. Evite a quebra realizando o pagamento no prazo.`;

    // Gera arquivo .ics (iOS / Apple Calendar)
    function gerarICS() {
      const conteudoICS = `
BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:Bradesco | Lembrete de Parcela
DTSTART:${inicioUTC}
DTEND:${fimUTC}
DESCRIPTION:Seu acordo com o Bradesco vence em ${dataTexto}. Evite a quebra realizando o pagamento no prazo.
END:VEVENT
END:VCALENDAR
`.trim();

      const blob = new Blob([conteudoICS], {
        type: 'text/calendar;charset=utf-8'
      });

      return URL.createObjectURL(blob);
    }

    const ua = navigator.userAgent;
    const isIOS = /iPhone|iPad|iPod/i.test(ua);


    // Tenta abrir automaticamente
    setTimeout(() => {
      if (isIOS) {
        window.location.href = gerarICS();
      } else {
        window.location.href = googleCalendarURL;
      }
    }, 300);
  </script>

</body>
</html>
